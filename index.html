<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Christmas Catch 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(#0d1b3d,#1a2f66);
  font-family:Poppins,Arial;
  color:white;
  text-align:center;
}
.box{
  background:rgba(255,255,255,.1);
  padding:30px;
  border-radius:15px;
  width:90%;
  max-width:420px;
}
.btn{
  width:100%;
  margin-top:15px;
  padding:14px;
  font-size:18px;
  background:#e6004c;
  border:0;
  border-radius:10px;
  color:white;
  cursor:pointer;
}
.wallet{
  margin-top:10px;
  font-size:14px;
  opacity:.9;
  word-break:break-all;
}
</style>
</head>
<body>

<div class="box">
  <h1>ðŸŽ„ Christmas Catch 2025</h1>
  <p>Official Tournament</p>

  <button class="btn" onclick="startGame()">Start Game</button>
  <button class="btn" onclick="location.href='leaderboard.html'">Leaderboard</button>

  <button class="btn" id="walletBtn">ðŸ”— Connect Wallet</button>
  <div class="wallet" id="walletInfo"></div>
</div>

<script>
/* ================== SOMNIA TESTNET ================== */
const SOMNIA = {
  chainId: "0xc4a8",
  chainName: "Somnia Testnet",
  nativeCurrency: { name:"STT", symbol:"STT", decimals:18 },
  rpcUrls: ["https://dream-rpc.somnia.network"],
  blockExplorerUrls: ["https://shannon-explorer.somnia.network"]
};

const walletBtn  = document.getElementById("walletBtn");
const walletInfo = document.getElementById("walletInfo");

/* ================== PROVIDER DETECT ================== */
function getProvider(){
  if(window.ethereum) return window.ethereum;
  alert("Wallet tidak ditemukan.\nBuka halaman ini via MetaMask Browser / Chrome / Brave.");
  return null;
}

/* ================== CONNECT WALLET ================== */
walletBtn.onclick = async () => {
  const provider = getProvider();
  if(!provider) return;

  try{
    // 1. Request account FIRST (fix mobile issue)
    const accounts = await provider.request({
      method: "eth_requestAccounts"
    });
    const wallet = accounts[0];

    // 2. Check chain
    const currentChain = await provider.request({
      method: "eth_chainId"
    });

    if(currentChain !== SOMNIA.chainId){
      try{
        await provider.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: SOMNIA.chainId }]
        });
      }catch(err){
        if(err.code === 4902){
          await provider.request({
            method: "wallet_addEthereumChain",
            params: [SOMNIA]
          });
        }else{
          alert("Gagal switch network");
          return;
        }
      }
    }

    // 3. Save wallet
    localStorage.setItem("wallet", wallet);
    updateUI(wallet);

  }catch(err){
    console.error(err);
    alert("Wallet connection dibatalkan atau gagal");
  }
};

/* ================== UI ================== */
function updateUI(wallet){
  walletBtn.textContent = "âœ… Wallet Connected";
  walletBtn.disabled = true;
  walletInfo.textContent =
    "Wallet: " + wallet.slice(0,6) + "..." + wallet.slice(-4);
}

/* ================== START GAME ================== */
function startGame(){
  if(!localStorage.getItem("wallet")){
    alert("Connect wallet terlebih dahulu!");
    return;
  }
  location.href = "game.html";
}

/* ================== AUTO LOAD ================== */
const savedWallet = localStorage.getItem("wallet");
if(savedWallet){
  updateUI(savedWallet);
}
</script>

</body>
</html>
